{% extends "layout.html" %}

{% block subtitle %}Dashboard{% endblock %}

{% block body %}
    <script>
        webix.ui({
            type: "space",
            cols: [
                {
                    id: "tree", view: "tree",
                    width: 200, select: true,
                    type: {
                        folder: function (item) {
                            let icon_class = "webix_icon mdi "
                            switch (item._type) {
                                case "form":
                                    icon_class += "mdi-application-cog-outline"
                                    return `<span class="${icon_class}"></span>`
                                case "datablock":
                                    icon_class += "mdi-database-cog-outline"
                                    return `<span class="${icon_class}"></span>`
                                case "item":
                                    icon_class += "mdi-form-textbox"
                                    return `<span class="${icon_class}"></span>`
                            }
                        }
                    },
                    data: [
                        {
                            _type: "form", value: "Form", data: [],
                        },
                    ],
                },
                {
                    rows: [],
                },
            ],
        })

        const tree = $$("tree")
        const context_menu = webix.ui({
            view: "contextmenu", width: 200,
            data: [
                {id: "form-add-datablock", value: "Add Data Block"},
                {id: "datablock-add-item", value: "Add Item"},
                {id: "separator", $template: "Separator"},
                {id: "form-properties", value: "Properties"},
                {id: "datablock-properties", value: "Properties"},
                {id: "item-properties", value: "Properties"},
            ],
        })

        context_menu.attachTo(tree)

        tree.attachEvent("onBeforeContextMenu", function (id) {
            let item = tree.getItem(id)

            tree.select(item.id)
            context_menu.data.each(function (datum) {
                context_menu.hideItem(datum.id)
            })

            switch (item._type) {
                case "form":
                    context_menu.showItem("separator")
                    context_menu.showItem("form-properties")
                    context_menu.showItem("form-add-datablock")
                    break
                case "datablock":
                    context_menu.showItem("separator")
                    context_menu.showItem("datablock-properties")
                    context_menu.showItem("datablock-add-item")
                    break
                case "item":
                    context_menu.showItem("item-properties")
                    break
            }
        })

        context_menu.attachEvent("onItemClick", function (id) {
            let newItem = {}
            let selectedItem = tree.getSelectedItem()

            switch (id) {
                case "form-add-datablock":
                    newItem = {_type: "datablock", value: "Data Block"}
                    tree.add(newItem, -1, selectedItem.id)
                    tree.open(selectedItem.id)
                    break
                case "datablock-add-item":
                    newItem = {_type: "item", value: "Item"}
                    tree.add(newItem, -1, selectedItem.id)
                    tree.open(selectedItem.id)
                    break
            }
        })
    </script>
{% endblock %}